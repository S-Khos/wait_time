import numpy as np
from sklearn.cluster import k_means
import matplotlib.pyplot as plt
from sklearn.mixture import GaussianMixture
from sklearn.cluster import DBSCAN
from sklearn.mixture import GaussianMixture
import numpy as np
import math
from scipy.stats import multivariate_normal
from sklearn.decomposition import PCA
from collections import deque
from fixed_buffer import FixedBuffer


class GMM:
    """
    Gaussian Mixture Model implementation for lane clustering

    TODO:
        - order of clusters and prediction, left to right 0-n
        - warm start for online learning
        - attention mechanism for initial means selection
    """

    def __init__(
        self, k=2, max_iters=100, tol=1e-4, epsilon=1 * 10**-8, warm_start=False
    ):
        self.k = k  # Number of components
        self.max_iters = max_iters  # Maximum Iterations
        self.tol = tol  # Convergence threshold
        self.epsilon = epsilon  # Small constant to prevent numerical issues
        self.means = None
        self.warm_start = warm_start
        self.data_buffer = FixedBuffer(max_len=70)

    def _initialize_params(self, X):
        # self.means = X[
        #     np.random.choice(X.shape[0], self.k, replace=False)
        # ]  # The randomly selected means
        x_min, x_max = np.min(X[:, 0]), np.max(X[:, 0])
        y_min, y_max = np.min(X[:, 1]), np.max(X[:, 1])
        # Generate evenly spaced points across the range of x
        # y_points = np.sum(y_max + y_min) // 2
        x_points = np.linspace(x_min, x_max, self.k)
        y_points = np.linspace(y_min, y_max, self.k)
        # Create a grid of points
        self.means = np.array(list(zip(x_points, y_points)))
        ##################
        self.covariances = [
            self._covariance(X) for _ in range(self.k)
        ]  # A covariance matrix is made for every single component. np.cov would work, but I hand coded a helper function to do this
        self.pi = 1 / self.k * np.ones(self.k)  # Equal probabilities for each component

    def _covariance(self, matrix):  # Hand coded helper function instead of np.cov
        average_matrix = np.divide(
            np.sum(matrix, axis=0), matrix.shape[0]
        )  # Calculating the average of each column
        result = (
            matrix - average_matrix
        )  # Subtract the average from each element in the column
        covariances = np.dot(
            result.T, result
        )  # Multiplying the deviations for covariances
        divided_covariances = covariances / (
            matrix.shape[0] - 1
        )  # dividing the covariance by n-1
        return (
            divided_covariances + np.eye(matrix.shape[1]) * self.epsilon
        )  # Returning the covariance matrix with a tiny number added to the diagonal to prevent singular matrix

    def _gaussian_pdf(self, X, mean, cov):
        cols_in_X = X.shape[1]  # The columns in X
        regularized_covariance_matrix = cov + self.epsilon * np.eye(
            cols_in_X
        )  # Regularized covariance matrix
        inverted_covariance_matrix = np.linalg.inv(
            regularized_covariance_matrix
        )  # The inverted covariance matrix
        mahalanobis_distance = self._mahalanobis_distance(
            X, mean, inverted_covariance_matrix
        )  # The Mahalanobis distance
        determinant_regularized_covariance_matrix = np.linalg.det(
            regularized_covariance_matrix
        )  # The determinant of the regularized covariance matrix
        n = X.shape[1]  # Features
        Gaussian = (
            1 / np.sqrt((2 * np.pi) ** n * determinant_regularized_covariance_matrix)
        ) * np.exp(
            -0.5 * mahalanobis_distance
        )  # Gaussian PDF
        return Gaussian

    def _mahalanobis_distance(
        self, matrix, mean, inverted_covariance_matrix
    ):  # Calculating the Mahalanobis distance
        diff = list()  # New list to hold all the different distances
        for row in matrix:  # Go through each row to calculate the distances
            diff.append(
                (row - mean) @ inverted_covariance_matrix @ (row - mean)
            )  # put each Mahalanobis distance in the list
        return np.array(diff)  # turn list to an numpy array and return it

    def _e_step(self, X):
        likelihoods = np.zeros(
            (X.shape[0], self.k)
        )  # Matrix of zeroes for storing log-likelihoods

        for i in range(self.k):  # Going through every single Gaussian component
            likelihoods[:, i] = self.pi[i] * self._gaussian_pdf(
                X, self.means[i], self.covariances[i]
            )  # Insert the likelihoods into the i-th column
        responsibilities = likelihoods / (
            np.sum(likelihoods, axis=1, keepdims=True) + self.epsilon
        )  # Normallizing and calculating the responsibilities
        return responsibilities

    def _m_step(self, X, responsibilities) -> None:
        sum_responsibilities = np.sum(
            responsibilities, axis=0
        )  # Sum of responsibilities for each component (N_k)

        for i in range(self.k):  # Loop over each Gaussian component
            self.pi[i] = (
                sum_responsibilities[i] / X.shape[0]
            )  # Update the mixing coefficients (priors)
            self.means[i] = (
                np.dot(responsibilities[:, i], X) / sum_responsibilities[i]
            )  # Update the means

            # Update the covariance matrices
            diff = (
                X - self.means[i]
            )  # Difference between the data points and the updated mean for component i
            cov = np.zeros((X.shape[1], X.shape[1]))  # Initialize the covariance matrix
            # Compute the covariance matrix manually
            for j in range(X.shape[0]):  # Loop over all data points
                outer_product = np.outer(
                    diff[j], diff[j]
                )  # Compute the outer product of the difference vector
                cov += (
                    responsibilities[j, i] * outer_product
                )  # Weight by the responsibility for component i
            self.covariances[i] = cov / sum_responsibilities[i] + self.epsilon * np.eye(
                X.shape[1]
            )  # Normalize the covariance matrix and add a small regularization term for numerical stability

    def _compute_log_likelihood(self, X) -> float:
        number_of_samples = X.shape[0]
        weighted_likelihoods = np.zeros(
            (number_of_samples, self.k)
        )  # The array that will hold the weighted likelihoods

        for j in range(
            self.k
        ):  # Go through each component and calculate the weighted likelihoods
            weighted_likelihoods[:, j] = self.pi[j] * self._gaussian_pdf(
                X, self.means[j], self.covariances[j]
            )  # holding all the weighted likelihoods. If no priors are multiplied, then all weights are equally likely which is wrong.

        summed_likelihoods = np.sum(
            weighted_likelihoods, axis=1
        )  # Sum all the likelihoods
        log_summed_likelihoods = np.sum(
            np.log(summed_likelihoods + self.epsilon)
        )  # Find the log of all datapoints, and then sum over all the datapoints.

        return log_summed_likelihoods

    def fit(self, X) -> None:
        X = np.array(X)
        ########################################
        if self.means is None or not self.warm_start:
            self._initialize_params(X)
        # append new data to the buffer as it comes in if warm_start is true
        self.data_buffer.append(X)
        X = self.data_buffer
        ####################################
        prev_log_likelihood = None
        for i in range(self.max_iters):
            old_means = self.means.copy()
            responsibilities = self._e_step(X)
            self._m_step(X, responsibilities)

            # Compute log-likelihood
            log_likelihood = self._compute_log_likelihood(X)
            print(f"Iteration {i}, Log-Likelihood: {log_likelihood}")

            # Check for convergence based on log-likelihood
            if (
                prev_log_likelihood is not None
                and abs(log_likelihood - prev_log_likelihood) < self.tol
            ):
                print(f"Converged at iteration {i}")

                break
            print(f"Iteration {i}, Centroids: {self.means}")
            prev_log_likelihood = log_likelihood

    def predict(self, X):
        responsibilities = self._e_step(X)
        return np.argmax(responsibilities, axis=1)


X = np.array(
    [
        (971, 1063),
        (951, 1082),
        (927, 1098),
        (904, 1116),
        (881, 1136),
        (863, 1155),
        (836, 1173),
        (814, 1191),
        (789, 1212),
        (762, 1234),
        (734, 1254),
        (703, 1275),
        (682, 1292),
        (659, 1309),
        (634, 1332),
        (608, 1352),
        (580, 1375),
        (552, 1399),
        (523, 1421),
        (508, 1451),
        (478, 1463),
        (448, 1484),
        (430, 1509),
        (423, 1540),
        (412, 1563),
        (395, 1582),
        (371, 1599),
        (348, 1615),
        (325, 1632),
        (305, 1649),
        (281, 1667),
        (256, 1688),
        (231, 1710),
        (210, 1729),
        (185, 1749),
        (157, 1776),
        (134, 1799),
        (106, 1825),
        (71, 1857),
        (651, 430),
        (677, 432),
        (702, 432),
        (735, 432),
        (760, 432),
        (786, 432),
        (813, 431),
        (839, 432),
        (865, 432),
        (892, 432),
        (918, 432),
        (944, 433),
        (977, 433),
        (1003, 434),
        (1037, 434),
        (1065, 433),
        (1260, 806),
        (1241, 825),
        (1222, 842),
        (1202, 861),
        (1182, 878),
        (1161, 898),
        (1141, 913),
        (1122, 931),
        (1101, 948),
        (1080, 965),
        (1059, 983),
        (1038, 1001),
        (1014, 1020),
        (995, 1037),
        (972, 1056),
        (951, 1073),
        (930, 1089),
        (908, 1106),
        (888, 1124),
        (867, 1141),
        (849, 1159),
        (825, 1177),
        (800, 1198),
        (779, 1214),
        (755, 1237),
        (729, 1256),
        (710, 1274),
        (690, 1294),
        (668, 1310),
        (646, 1329),
        (623, 1348),
        (597, 1378),
        (571, 1400),
        (543, 1422),
        (513, 1447),
        (483, 1473),
        (453, 1501),
        (422, 1530),
        (389, 1560),
        (359, 1587),
        (345, 1613),
        (327, 1633),
        (301, 1652),
        (278, 1669),
        (253, 1689),
        (232, 1706),
        (213, 1726),
        (193, 1743),
        (170, 1765),
        (148, 1787),
        (128, 1806),
        (105, 1831),
        (73, 1863),
        (53, 1884),
        (282, 410),
        (257, 415),
        (281, 426),
        (307, 428),
        (332, 432),
        (358, 435),
        (383, 440),
        (408, 442),
        (435, 444),
        (460, 447),
        (485, 446),
        (512, 447),
        (537, 450),
        (562, 455),
        (584, 468),
        (561, 483),
        (535, 490),
        (507, 491),
        (480, 496),
        (456, 503),
        (431, 512),
        (405, 520),
        (379, 526),
        (353, 535),
        (329, 542),
        (303, 550),
        (276, 556),
        (258, 574),
        (232, 576),
        (207, 578),
        (182, 581),
        (154, 590),
        (128, 596),
        (103, 604),
        (78, 611),
        (53, 618),
        (28, 610),
        (1415, 669),
        (1395, 686),
        (1377, 704),
        (1357, 719),
        (1341, 740),
        (1324, 760),
        (1305, 780),
        (1284, 798),
        (1265, 818),
        (1245, 835),
        (1226, 855),
        (1207, 873),
        (1187, 891),
        (1168, 909),
        (1146, 927),
        (1128, 945),
        (1106, 962),
        (1083, 984),
        (1059, 1004),
        (1039, 1022),
        (1019, 1039),
        (993, 1060),
        (975, 1078),
        (951, 1098),
        (927, 1118),
        (906, 1137),
        (888, 1155),
        (867, 1172),
        (849, 1190),
        (829, 1206),
        (810, 1224),
        (789, 1243),
        (764, 1263),
        (741, 1284),
        (716, 1307),
        (698, 1325),
        (677, 1343),
        (655, 1362),
        (631, 1384),
        (605, 1408),
        (578, 1433),
        (549, 1460),
        (518, 1489),
        (489, 1513),
        (459, 1542),
        (430, 1573),
        (402, 1594),
        (373, 1612),
        (345, 1626),
        (326, 1645),
        (306, 1663),
        (287, 1680),
        (266, 1699),
        (244, 1718),
        (225, 1735),
        (203, 1753),
        (179, 1774),
        (150, 1799),
        (126, 1821),
        (95, 1846),
        (56, 1883),
        (360, 832),
        (334, 838),
        (307, 848),
        (283, 861),
        (260, 871),
        (237, 881),
        (213, 893),
        (191, 906),
        (176, 927),
        (154, 939),
        (135, 922),
        (132, 947),
        (108, 954),
        (88, 970),
        (68, 990),
        (48, 1010),
        (1679, 1074),
        (1674, 1100),
        (1667, 1125),
        (1659, 1152),
        (1651, 1179),
        (1645, 1204),
        (1638, 1233),
        (1629, 1257),
        (1618, 1282),
        (1611, 1309),
        (1603, 1336),
        (1597, 1362),
        (1588, 1388),
        (1577, 1412),
        (1568, 1440),
        (1558, 1468),
        (1550, 1496),
        (1541, 1525),
        (1530, 1551),
        (1515, 1572),
        (1497, 1590),
        (1477, 1609),
        (1460, 1629),
        (1443, 1649),
        (1423, 1664),
        (1400, 1684),
        (1411, 1707),
        (1406, 1739),
        (1397, 1772),
        (1398, 1805),
        (1394, 1832),
        (1387, 1861),
        (1380, 1892),
        (272, 447),
        (298, 453),
        (324, 455),
        (351, 459),
        (377, 460),
        (403, 459),
        (429, 463),
        (452, 477),
        (429, 489),
        (405, 498),
        (379, 503),
        (354, 511),
        (326, 516),
        (299, 526),
        (271, 534),
        (244, 540),
        (280, 531),
        (305, 525),
        (240, 542),
        (209, 552),
        (236, 536),
        (211, 545),
        (187, 552),
        (161, 559),
        (1488, 592),
        (1469, 612),
        (1450, 630),
        (1432, 648),
        (1412, 666),
        (1395, 686),
        (1376, 705),
        (1358, 723),
        (1338, 742),
        (1318, 761),
        (1299, 779),
        (1280, 797),
        (1261, 814),
        (1242, 831),
        (1223, 848),
        (1203, 866),
        (1184, 884),
        (1162, 903),
        (1140, 921),
        (1118, 941),
        (1095, 962),
        (1070, 981),
        (1046, 1004),
        (1022, 1023),
        (999, 1045),
        (979, 1063),
        (960, 1080),
        (939, 1097),
        (920, 1114),
        (899, 1132),
        (874, 1155),
        (851, 1173),
        (827, 1197),
        (801, 1220),
        (772, 1243),
        (753, 1262),
        (731, 1282),
        (709, 1301),
        (684, 1326),
        (660, 1349),
        (633, 1374),
        (605, 1401),
        (574, 1426),
        (545, 1455),
        (513, 1489),
        (480, 1519),
        (451, 1548),
        (421, 1575),
        (393, 1595),
        (371, 1608),
        (351, 1626),
        (332, 1643),
        (312, 1663),
        (289, 1683),
        (269, 1703),
        (243, 1726),
        (213, 1751),
        (191, 1772),
        (167, 1793),
        (140, 1819),
        (107, 1848),
        (67, 1880),
        (299, 434),
        (324, 435),
        (349, 436),
        (373, 428),
        (396, 442),
        (421, 442),
        (446, 442),
        (472, 442),
        (497, 442),
        (523, 442),
        (550, 443),
        (578, 443),
        (605, 447),
        (627, 459),
        (617, 483),
        (592, 495),
        (566, 508),
        (540, 518),
        (516, 526),
        (492, 535),
        (465, 545),
        (438, 553),
        (413, 561),
        (389, 568),
        (365, 577),
        (337, 585),
        (310, 592),
        (289, 607),
        (261, 614),
        (234, 622),
        (208, 616),
        (183, 626),
        (157, 635),
        (134, 648),
        (108, 657),
        (82, 661),
        (65, 640),
        (50, 660),
        (54, 632),
        (50, 657),
        (52, 630),
        (48, 656),
        (46, 630),
        (38, 656),
        (1759, 779),
        (1752, 804),
        (1749, 829),
        (1743, 854),
        (1738, 880),
        (1733, 907),
        (1726, 931),
        (1721, 956),
        (1715, 982),
        (1710, 1009),
        (1704, 1036),
        (1699, 1062),
        (1692, 1087),
        (1686, 1112),
        (1681, 1138),
        (1675, 1165),
        (1669, 1193),
        (1662, 1224),
        (1655, 1254),
        (1647, 1283),
        (1640, 1316),
        (1636, 1341),
        (1628, 1365),
        (1621, 1390),
        (1615, 1420),
        (1607, 1455),
        (1602, 1485),
        (1595, 1516),
        (1586, 1544),
        (1576, 1572),
        (1563, 1601),
        (1544, 1621),
        (1531, 1645),
        (1523, 1672),
        (1506, 1691),
        (1490, 1712),
        (1504, 1737),
        (1500, 1765),
        (1495, 1792),
        (1487, 1827),
        (1480, 1856),
        (1464, 1885),
        (1495, 601),
        (1477, 620),
        (1460, 639),
        (1441, 657),
        (1423, 677),
        (1403, 695),
        (1384, 713),
        (1368, 733),
        (1348, 751),
        (1330, 772),
        (1310, 790),
        (1290, 809),
        (1270, 827),
        (1252, 845),
        (1232, 864),
        (1212, 882),
        (1192, 904),
        (1170, 923),
        (1146, 946),
        (1125, 966),
        (1103, 987),
        (1085, 1005),
        (1062, 1027),
        (1038, 1048),
        (1015, 1070),
        (994, 1091),
        (972, 1111),
        (953, 1130),
        (930, 1149),
        (913, 1169),
        (894, 1187),
        (871, 1206),
        (849, 1227),
        (828, 1249),
        (807, 1268),
        (784, 1288),
        (757, 1310),
        (738, 1330),
        (718, 1348),
        (697, 1368),
        (675, 1391),
        (652, 1412),
        (627, 1436),
        (601, 1462),
        (577, 1488),
        (555, 1514),
        (532, 1533),
        (508, 1559),
        (487, 1580),
        (465, 1598),
        (446, 1615),
        (420, 1631),
        (392, 1646),
        (364, 1657),
        (341, 1672),
        (323, 1693),
        (303, 1711),
        (284, 1729),
        (260, 1751),
        (238, 1774),
        (212, 1800),
        (191, 1817),
        (170, 1836),
        (143, 1856),
        (105, 1878),
        (83, 1891),
        (631, 704),
        (609, 717),
        (584, 727),
        (559, 737),
        (535, 746),
        (509, 757),
        (483, 769),
        (458, 778),
        (435, 790),
        (412, 800),
        (387, 810),
        (364, 820),
        (340, 831),
        (316, 841),
        (291, 854),
        (265, 866),
        (237, 877),
        (210, 891),
        (185, 901),
        (171, 923),
        (154, 943),
        (137, 963),
        (111, 967),
        (87, 974),
        (62, 983),
        (45, 1002),
        (553, 906),
        (530, 919),
        (506, 933),
        (483, 946),
        (457, 961),
        (432, 976),
        (406, 991),
        (379, 1008),
        (356, 1023),
        (328, 1038),
        (305, 1052),
        (279, 1067),
        (251, 1081),
        (238, 1106),
        (226, 1129),
        (207, 1146),
        (193, 1169),
        (178, 1189),
        (163, 1213),
        (138, 1206),
        (114, 1218),
        (91, 1232),
        (68, 1245),
        (50, 1266),
        (37, 1294),
        (1785, 590),
        (1785, 615),
        (1781, 640),
        (1779, 670),
        (1774, 696),
        (1771, 723),
        (1768, 750),
        (1765, 775),
        (1761, 800),
        (1759, 825),
        (1756, 851),
        (1751, 877),
        (1749, 902),
        (1745, 929),
        (1742, 955),
        (1740, 980),
        (1736, 1005),
        (1733, 1030),
        (1732, 1055),
        (1730, 1081),
        (1723, 1105),
        (1721, 1134),
        (1716, 1163),
        (1715, 1188),
        (1712, 1213),
        (1709, 1240),
        (1701, 1276),
        (1690, 1311),
        (1676, 1346),
        (1658, 1380),
        (1647, 1404),
        (1636, 1433),
        (1622, 1459),
        (1608, 1483),
        (1596, 1512),
        (1578, 1540),
        (1560, 1558),
        (1539, 1573),
        (1517, 1589),
        (1500, 1609),
        (1484, 1634),
        (1463, 1654),
        (1460, 1685),
        (1453, 1709),
        (1443, 1736),
        (1435, 1764),
        (1425, 1796),
        (1428, 1832),
        (1424, 1858),
        (897, 748),
        (876, 762),
        (851, 773),
        (825, 788),
        (802, 803),
        (777, 816),
        (754, 830),
        (730, 841),
        (709, 856),
        (687, 868),
        (664, 880),
        (642, 893),
        (619, 906),
        (595, 921),
        (570, 936),
        (548, 949),
        (523, 962),
        (499, 978),
        (476, 993),
        (451, 1004),
        (428, 1017),
        (404, 1029),
        (381, 1041),
        (360, 1058),
        (335, 1072),
        (312, 1083),
        (289, 1100),
        (266, 1113),
        (244, 1127),
        (223, 1143),
        (208, 1173),
        (196, 1199),
        (180, 1219),
        (165, 1244),
        (141, 1253),
        (118, 1263),
        (96, 1276),
        (71, 1285),
        (54, 1308),
        (38, 1329),
        (1472, 612),
        (1454, 630),
        (1436, 649),
        (1419, 668),
        (1397, 685),
        (1380, 704),
        (1361, 721),
        (1343, 741),
        (1322, 760),
        (1304, 780),
        (1283, 798),
        (1263, 818),
        (1244, 837),
        (1225, 854),
        (1208, 874),
        (1188, 892),
        (1168, 912),
        (1148, 933),
        (1126, 953),
        (1106, 970),
        (1086, 985),
        (1065, 1003),
        (1041, 1021),
        (1017, 1042),
        (995, 1059),
        (977, 1079),
        (960, 1098),
        (940, 1115),
        (920, 1134),
        (900, 1151),
        (877, 1170),
        (855, 1184),
        (833, 1205),
        (808, 1225),
        (779, 1249),
        (760, 1270),
        (738, 1286),
        (715, 1310),
        (690, 1331),
        (662, 1355),
        (634, 1379),
        (608, 1406),
        (581, 1429),
        (554, 1455),
        (526, 1477),
        (501, 1501),
        (472, 1526),
        (443, 1552),
        (420, 1574),
        (398, 1597),
        (376, 1616),
        (356, 1633),
        (335, 1653),
        (314, 1670),
        (294, 1689),
        (272, 1705),
        (254, 1725),
        (233, 1745),
        (212, 1761),
        (185, 1783),
        (163, 1805),
        (134, 1830),
        (114, 1845),
        (96, 1863),
        (74, 1880),
        (52, 1898),
        (942, 569),
        (967, 545),
        (928, 569),
        (904, 582),
        (928, 566),
        (901, 577),
        (929, 557),
        (883, 583),
        (915, 559),
        (883, 584),
        (860, 599),
        (899, 569),
        (873, 588),
        (900, 570),
        (921, 552),
        (883, 582),
        (903, 566),
        (881, 583),
        (903, 569),
        (869, 593),
        (896, 573),
        (873, 591),
        (898, 572),
        (918, 557),
        (882, 581),
        (912, 559),
        (882, 582),
        (912, 560),
        (882, 581),
        (913, 560),
        (882, 582),
        (860, 597),
        (896, 570),
        (916, 553),
        (883, 582),
        (863, 597),
        (898, 570),
        (869, 593),
        (900, 569),
        (875, 588),
        (900, 569),
        (920, 554),
        (882, 581),
        (862, 597),
        (900, 569),
        (868, 592),
        (846, 604),
        (819, 611),
        (794, 618),
        (770, 629),
        (747, 640),
        (722, 648),
        (759, 619),
        (779, 604),
        (720, 641),
        (699, 655),
        (676, 666),
        (653, 676),
        (699, 640),
        (721, 624),
        (665, 660),
        (642, 673),
        (687, 645),
        (709, 629),
        (659, 662),
        (638, 676),
        (686, 645),
        (710, 629),
        (661, 665),
        (632, 684),
        (366, 421),
        (392, 420),
        (418, 419),
        (443, 418),
        (538, 419),
        (563, 424),
        (588, 425),
        (614, 430),
        (640, 432),
        (665, 436),
        (691, 439),
        (718, 439),
        (743, 438),
        (770, 438),
        (797, 437),
        (822, 435),
        (847, 435),
        (837, 412),
        (850, 434),
        (838, 411),
        (849, 434),
        (878, 437),
        (903, 436),
        (928, 436),
        (953, 436),
        (978, 435),
        (1021, 419),
        (997, 429),
        (976, 414),
        (945, 389),
        (916, 381),
        (884, 383),
        (855, 383),
        (830, 383),
        (799, 386),
        (773, 387),
        (748, 388),
        (719, 389),
        (692, 391),
        (667, 392),
        (641, 393),
        (616, 394),
        (589, 395),
        (561, 397),
        (533, 399),
        (508, 400),
        (483, 400),
        (442, 402),
        (417, 401),
        (1736, 673),
        (1728, 698),
        (1722, 723),
        (1715, 748),
        (1709, 773),
        (1704, 798),
        (1699, 823),
        (1694, 848),
        (1688, 874),
        (1684, 900),
        (1678, 926),
        (1673, 953),
        (1667, 980),
        (1660, 1008),
        (1655, 1034),
        (1649, 1059),
        (1642, 1084),
        (1636, 1110),
        (1629, 1136),
        (1623, 1161),
        (1618, 1191),
        (1610, 1221),
        (1604, 1248),
        (1594, 1274),
        (1587, 1302),
        (1580, 1330),
        (1570, 1358),
        (1558, 1387),
        (1548, 1420),
        (1537, 1453),
        (1528, 1479),
        (1519, 1504),
        (1506, 1535),
        (1491, 1558),
        (1472, 1577),
        (1452, 1593),
        (1435, 1612),
        (1424, 1636),
        (1406, 1659),
        (1386, 1680),
        (1403, 1701),
        (1396, 1740),
        (1387, 1770),
        (1376, 1802),
        (1365, 1841),
        (1345, 1884),
        (2366, 1039),
        (2362, 1010),
        (2366, 1035),
        (2361, 1007),
        (2365, 1035),
        (2361, 1009),
        (2365, 1035),
        (2361, 1008),
        (2365, 1036),
        (2362, 1007),
        (2366, 1036),
        (2362, 1009),
        (2366, 1034),
        (2361, 1006),
        (2365, 1036),
        (2362, 1007),
        (2365, 1037),
        (2362, 1011),
        (2366, 1037),
        (2361, 1006),
        (2365, 1033),
        (2362, 1008),
        (2366, 1035),
        (2370, 1060),
        (2364, 1025),
        (2367, 1051),
        (2364, 1022),
        (2367, 1050),
        (2364, 1023),
        (2369, 1052),
        (2363, 1019),
        (2367, 1048),
        (2364, 1021),
        (2369, 1049),
        (2364, 1021),
        (2367, 1051),
        (2364, 1024),
        (2367, 1051),
        (2364, 1023),
        (2368, 1053),
        (2378, 1077),
        (2391, 1100),
        (2404, 1127),
        (2406, 1152),
        (2410, 1179),
        (2413, 1204),
        (2416, 1231),
        (2418, 1258),
        (2422, 1286),
        (2424, 1316),
        (2426, 1343),
        (2429, 1368),
        (2435, 1397),
        (2438, 1425),
        (2440, 1458),
        (2443, 1489),
        (2446, 1521),
        (2453, 1552),
        (2468, 1572),
        (2475, 1596),
        (2486, 1620),
        (2491, 1646),
        (2497, 1673),
        (2507, 1703),
        (2514, 1727),
        (2519, 1760),
        (2526, 1792),
        (2540, 1827),
        (2549, 1855),
        (2564, 1887),
        (1430, 648),
        (1412, 666),
        (1392, 681),
        (1375, 700),
        (1355, 717),
        (1335, 735),
        (1316, 752),
        (1297, 771),
        (1277, 787),
        (1256, 805),
        (1236, 824),
        (1216, 839),
        (1193, 861),
        (1170, 880),
        (1147, 899),
        (1121, 922),
        (1097, 941),
        (1078, 961),
        (1051, 981),
        (1031, 999),
        (1010, 1014),
        (990, 1033),
        (964, 1052),
        (942, 1071),
        (919, 1092),
        (896, 1111),
        (875, 1128),
        (854, 1145),
        (832, 1164),
        (805, 1186),
        (783, 1204),
        (754, 1226),
        (723, 1251),
        (690, 1279),
        (655, 1309),
        (621, 1336),
        (588, 1365),
        (552, 1390),
        (521, 1423),
        (491, 1449),
        (464, 1476),
        (434, 1500),
        (417, 1521),
        (403, 1546),
        (382, 1562),
        (361, 1576),
        (341, 1596),
        (322, 1615),
        (296, 1637),
        (268, 1660),
        (246, 1679),
        (219, 1706),
        (187, 1734),
        (149, 1771),
        (125, 1794),
        (98, 1822),
        (806, 782),
        (784, 795),
        (763, 809),
        (739, 819),
        (712, 832),
        (690, 845),
        (667, 858),
        (644, 869),
        (622, 881),
        (597, 893),
        (573, 908),
        (547, 920),
        (525, 933),
        (503, 946),
        (479, 959),
        (456, 970),
        (430, 985),
        (408, 999),
        (383, 1012),
        (361, 1024),
        (337, 1038),
        (314, 1050),
        (291, 1062),
        (267, 1073),
        (249, 1091),
        (237, 1114),
        (224, 1136),
        (211, 1160),
        (191, 1182),
        (176, 1203),
        (148, 1202),
        (125, 1219),
        (96, 1228),
        (73, 1246),
        (57, 1270),
        (40, 1294),
        (628, 686),
        (685, 647),
        (708, 632),
        (658, 665),
        (629, 685),
        (686, 645),
        (710, 628),
        (658, 664),
        (629, 684),
        (714, 626),
        (659, 666),
        (639, 681),
        (686, 637),
        (709, 617),
        (658, 660),
        (630, 683),
        (686, 637),
        (710, 618),
        (658, 661),
        (630, 685),
        (1759, 702),
        (1758, 728),
        (1752, 754),
        (1750, 779),
        (1744, 804),
        (1739, 829),
        (1734, 854),
        (1727, 879),
        (1723, 904),
        (1719, 930),
        (1714, 957),
        (1707, 982),
        (1701, 1007),
        (1694, 1031),
        (1688, 1060),
        (1682, 1088),
        (1674, 1112),
        (1668, 1139),
        (1663, 1165),
        (1658, 1192),
        (1653, 1220),
        (1646, 1245),
        (1641, 1273),
        (1633, 1298),
        (1623, 1325),
        (1616, 1357),
        (1608, 1386),
        (1597, 1420),
        (1588, 1451),
        (1582, 1477),
        (1576, 1505),
        (1566, 1529),
        (1557, 1556),
        (1550, 1584),
        (1535, 1607),
        (1521, 1634),
        (1499, 1657),
        (1483, 1681),
        (1476, 1706),
        (1459, 1727),
        (1444, 1747),
        (1459, 1767),
        (1459, 1792),
        (1454, 1822),
        (1445, 1848),
        (1430, 1879),
        (1759, 618),
        (1758, 643),
        (1756, 669),
        (1751, 694),
        (1746, 720),
        (1743, 748),
        (1739, 773),
        (1734, 799),
        (1730, 825),
        (1725, 851),
        (1721, 876),
        (1715, 901),
        (1711, 929),
        (1703, 955),
        (1696, 981),
        (1688, 1008),
        (1683, 1033),
        (1678, 1058),
        (1671, 1086),
        (1663, 1110),
        (1655, 1134),
        (1650, 1162),
        (1644, 1187),
        (1637, 1214),
        (1629, 1245),
        (1622, 1272),
        (1612, 1300),
        (1604, 1326),
        (1598, 1354),
        (1588, 1387),
        (1576, 1415),
        (1564, 1452),
        (1557, 1481),
        (1547, 1508),
        (1537, 1539),
        (1528, 1567),
        (1514, 1591),
        (1493, 1612),
        (1473, 1631),
        (1462, 1654),
        (1448, 1678),
        (1429, 1699),
        (1441, 1722),
        (1440, 1753),
        (1434, 1783),
        (1427, 1815),
        (1417, 1840),
        (1406, 1869),
        (2297, 825),
        (2307, 850),
        (2322, 872),
        (2336, 896),
        (2349, 918),
        (2362, 943),
        (2375, 967),
        (2383, 991),
        (2392, 1016),
        (2402, 1041),
        (2410, 1065),
        (2420, 1090),
        (2426, 1115),
        (2434, 1141),
        (2433, 1168),
        (2436, 1198),
        (2436, 1226),
        (2436, 1258),
        (2439, 1284),
        (2441, 1310),
        (2442, 1338),
        (2445, 1365),
        (2447, 1391),
        (2452, 1424),
        (2461, 1448),
        (2466, 1473),
        (2471, 1502),
        (2472, 1530),
        (2475, 1559),
        (2477, 1591),
        (2479, 1621),
        (2491, 1646),
        (2502, 1670),
        (2515, 1700),
        (2523, 1729),
        (2530, 1754),
        (2536, 1785),
        (2543, 1822),
        (716, 616),
        (659, 661),
        (631, 684),
        (687, 641),
        (711, 620),
        (659, 661),
        (631, 683),
        (687, 638),
        (645, 671),
        (686, 640),
        (710, 622),
        (658, 664),
        (630, 687),
        (712, 619),
        (654, 665),
        (629, 687),
        (686, 638),
        (710, 620),
        (658, 661),
        (638, 676),
        (212, 552),
        (187, 550),
        (258, 587),
        (284, 601),
        (263, 615),
        (239, 608),
        (218, 622),
        (193, 626),
        (177, 605),
        (156, 619),
        (136, 635),
        (114, 649),
        (87, 639),
        (72, 659),
        (53, 640),
        (30, 655),
        (816, 644),
        (792, 652),
        (769, 662),
        (746, 673),
        (723, 683),
        (699, 690),
        (674, 699),
        (652, 711),
        (627, 725),
        (601, 733),
        (577, 742),
        (550, 752),
        (524, 762),
        (500, 776),
        (474, 787),
        (450, 797),
        (424, 803),
        (401, 816),
        (378, 826),
        (354, 836),
        (328, 846),
        (302, 859),
        (277, 871),
        (250, 884),
        (225, 893),
        (207, 914),
        (188, 933),
        (162, 953),
        (139, 963),
        (113, 963),
        (94, 982),
        (68, 991),
        (50, 1011),
        (310, 429),
        (336, 434),
        (361, 437),
        (386, 441),
        (412, 443),
        (437, 444),
        (463, 444),
        (491, 442),
        (516, 441),
        (545, 441),
        (572, 440),
        (597, 438),
        (622, 441),
        (649, 441),
        (670, 456),
        (697, 460),
        (670, 474),
        (644, 476),
        (620, 483),
        (595, 481),
        (570, 478),
        (539, 487),
        (514, 498),
        (485, 504),
        (462, 516),
        (431, 523),
        (406, 531),
        (381, 541),
        (354, 545),
        (325, 551),
        (300, 558),
        (276, 572),
        (250, 575),
        (225, 583),
        (199, 581),
        (172, 584),
        (147, 586),
        (121, 596),
        (94, 602),
        (72, 615),
        (46, 613),
        (1487, 641),
        (1468, 658),
        (1450, 679),
        (1435, 699),
        (1412, 710),
        (1393, 728),
        (1372, 748),
        (1351, 768),
        (1332, 785),
        (1312, 805),
        (1292, 823),
        (1273, 843),
        (1253, 861),
        (1237, 881),
        (1224, 903),
        (1199, 914),
        (1178, 932),
        (1157, 953),
        (1136, 971),
        (1118, 989),
        (1098, 1005),
        (1078, 1026),
        (1059, 1045),
        (1040, 1063),
        (1020, 1081),
        (998, 1101),
        (978, 1119),
        (957, 1139),
        (939, 1157),
        (921, 1175),
        (903, 1194),
        (882, 1209),
        (861, 1230),
        (837, 1253),
        (813, 1275),
        (794, 1293),
        (770, 1317),
        (744, 1341),
        (726, 1361),
        (704, 1379),
        (682, 1400),
        (660, 1423),
        (637, 1442),
        (612, 1467),
        (589, 1492),
        (565, 1515),
        (541, 1538),
        (518, 1559),
        (494, 1582),
        (472, 1600),
        (440, 1615),
        (409, 1631),
        (384, 1641),
        (363, 1657),
        (344, 1677),
        (324, 1696),
        (301, 1717),
        (280, 1737),
        (260, 1755),
        (240, 1776),
        (216, 1797),
        (189, 1823),
        (164, 1842),
        (134, 1859),
        (111, 1870),
        (71, 1894),
        (50, 1910),
        (1821, 604),
        (1817, 630),
        (1811, 655),
        (1804, 681),
        (1795, 705),
        (1785, 728),
        (1777, 753),
        (1771, 778),
        (1762, 802),
        (1754, 829),
        (1744, 853),
        (1736, 877),
        (1730, 903),
        (1721, 928),
        (1713, 952),
        (1706, 978),
        (1697, 1002),
        (1691, 1029),
        (1686, 1055),
        (1677, 1080),
        (1669, 1104),
        (1661, 1130),
        (1652, 1155),
        (1645, 1184),
        (1636, 1210),
        (1628, 1236),
        (1615, 1264),
        (1604, 1291),
        (1597, 1319),
        (1589, 1344),
        (1574, 1376),
        (1561, 1409),
        (1552, 1434),
        (1543, 1460),
        (1532, 1487),
        (1520, 1518),
        (1505, 1547),
        (1483, 1565),
        (1460, 1582),
        (1438, 1600),
        (1421, 1619),
        (1399, 1638),
        (1383, 1659),
        (1408, 1671),
        (1402, 1700),
        (1392, 1724),
        (1385, 1753),
        (1376, 1791),
        (1374, 1822),
        (1368, 1860),
        (2161, 708),
        (2179, 726),
        (2194, 747),
        (2209, 768),
        (2224, 790),
        (2238, 811),
        (2252, 832),
        (2267, 852),
        (2279, 874),
        (2293, 898),
        (2306, 920),
        (2320, 942),
        (2332, 967),
        (2345, 990),
        (2355, 1014),
        (2365, 1037),
        (2374, 1061),
        (2387, 1084),
        (2397, 1110),
        (2409, 1133),
        (2422, 1158),
        (2426, 1185),
        (2428, 1212),
        (2430, 1245),
        (2432, 1271),
        (2435, 1303),
        (2438, 1338),
        (2440, 1371),
        (2444, 1404),
        (2448, 1430),
        (2452, 1459),
        (2457, 1488),
        (2462, 1524),
        (2469, 1559),
        (2472, 1584),
        (2474, 1611),
        (2485, 1636),
        (2498, 1658),
        (2508, 1681),
        (2519, 1709),
        (2529, 1736),
        (2533, 1763),
        (2540, 1791),
        (2546, 1816),
        (2558, 1847),
        (1498, 613),
        (1479, 630),
        (1459, 646),
        (1440, 663),
        (1422, 682),
        (1402, 697),
        (1385, 716),
        (1369, 736),
        (1349, 754),
        (1328, 772),
        (1311, 791),
        (1293, 810),
        (1275, 829),
        (1255, 848),
        (1238, 867),
        (1218, 882),
        (1201, 903),
        (1181, 923),
        (1159, 943),
        (1139, 964),
        (1118, 981),
        (1098, 1003),
        (1075, 1024),
        (1053, 1044),
        (1032, 1068),
        (1009, 1086),
        (988, 1106),
        (968, 1127),
        (947, 1147),
        (928, 1167),
        (905, 1183),
        (887, 1204),
        (866, 1224),
        (841, 1247),
        (818, 1269),
        (792, 1293),
        (774, 1311),
        (754, 1327),
        (733, 1350),
        (711, 1370),
        (690, 1389),
        (668, 1410),
        (647, 1428),
        (626, 1449),
        (607, 1470),
        (588, 1489),
        (570, 1507),
        (545, 1531),
        (524, 1553),
        (503, 1570),
        (482, 1585),
        (455, 1600),
        (431, 1612),
        (407, 1619),
        (383, 1630),
        (362, 1650),
        (339, 1672),
        (317, 1690),
        (291, 1713),
        (271, 1731),
        (249, 1751),
        (223, 1772),
        (196, 1794),
        (160, 1819),
        (119, 1847),
        (93, 1869),
        (1116, 638),
        (1092, 650),
        (1068, 657),
        (1046, 670),
        (1024, 683),
        (1001, 696),
        (978, 708),
        (955, 721),
        (931, 733),
        (907, 746),
        (884, 758),
        (863, 772),
        (840, 786),
        (817, 798),
        (795, 810),
        (771, 822),
        (748, 834),
        (726, 846),
        (703, 862),
        (679, 873),
        (656, 889),
        (630, 903),
        (606, 916),
        (582, 929),
        (558, 943),
        (532, 957),
        (505, 972),
        (480, 986),
        (457, 1001),
        (431, 1014),
        (407, 1029),
        (381, 1043),
        (358, 1057),
        (335, 1070),
        (314, 1086),
        (292, 1100),
        (269, 1113),
        (247, 1125),
        (235, 1148),
        (223, 1170),
        (210, 1194),
        (193, 1216),
        (174, 1234),
        (148, 1240),
        (122, 1248),
        (98, 1258),
        (1145, 598),
        (1121, 609),
        (1101, 625),
        (1078, 635),
        (1056, 649),
        (1033, 660),
        (1011, 672),
        (988, 685),
        (965, 698),
        (941, 710),
        (916, 720),
        (893, 734),
        (869, 747),
        (844, 759),
        (819, 769),
        (797, 787),
        (772, 796),
        (753, 813),
        (731, 825),
        (709, 837),
        (684, 850),
        (660, 862),
        (633, 874),
        (2112, 383),
        (2084, 381),
        (2055, 379),
        (2022, 381),
        (1996, 379),
        (1957, 381),
        (1927, 381),
        (1902, 377),
        (1869, 378),
        (1841, 375),
        (1813, 375),
        (1780, 374),
        (1755, 372),
        (1730, 373),
        (1693, 374),
        (1661, 371),
        (1634, 371),
        (1604, 371),
        (1576, 371),
        (1549, 370),
        (1516, 373),
        (1483, 373),
        (1456, 374),
        (1430, 375),
        (1400, 374),
        (1369, 375),
        (1341, 374),
        (1313, 374),
        (1280, 374),
        (1254, 372),
        (1227, 375),
        (1193, 375),
        (1167, 373),
        (1140, 371),
        (1106, 366),
        (1072, 365),
        (966, 391),
        (941, 392),
        (913, 384),
        (885, 384),
        (857, 384),
        (826, 386),
        (794, 388),
        (768, 389),
        (741, 389),
        (713, 389),
        (676, 392),
        (624, 393),
        (595, 394),
        (566, 394),
        (538, 396),
        (512, 399),
        (484, 401),
        (454, 401),
        (425, 401),
        (398, 399),
        (318, 407),
        (324, 432),
        (347, 443),
        (372, 446),
        (399, 449),
        (426, 450),
        (451, 450),
        (522, 468),
        (504, 490),
        (478, 493),
        (454, 500),
        (426, 510),
        (403, 521),
        (375, 528),
        (372, 443),
        (397, 444),
        (422, 446),
        (450, 448),
        (473, 434),
        (500, 434),
        (522, 446),
        (548, 445),
        (574, 444),
        (601, 445),
        (627, 449),
        (649, 461),
        (647, 486),
        (623, 493),
        (596, 497),
        (566, 501),
        (539, 513),
        (506, 520),
        (528, 507),
        (487, 519),
        (463, 529),
        (499, 515),
        (446, 534),
        (474, 521),
        (398, 548),
        (427, 532),
        (402, 535),
        (373, 546),
        (331, 558),
        (294, 567),
        (291, 592),
        (274, 616),
        (243, 600),
        (221, 619),
        (195, 613),
        (172, 601),
        (155, 620),
        (138, 639),
        (130, 615),
        (130, 589),
        (127, 615),
        (1798, 581),
        (1795, 606),
        (1791, 631),
        (1788, 656),
        (1781, 680),
        (1775, 705),
        (1775, 730),
        (1770, 756),
        (1766, 781),
        (1765, 809),
        (1759, 834),
        (1754, 861),
        (1745, 886),
        (1740, 912),
        (1733, 939),
        (1724, 966),
        (1717, 992),
        (1710, 1016),
        (1705, 1041),
        (1699, 1067),
        (1690, 1092),
        (1681, 1122),
        (1673, 1154),
        (1666, 1179),
        (1659, 1210),
        (1651, 1244),
        (1641, 1268),
        (1629, 1298),
        (1619, 1324),
        (1610, 1352),
        (1601, 1381),
        (1588, 1410),
        (1575, 1440),
        (1567, 1470),
        (1558, 1500),
        (1548, 1528),
        (1534, 1552),
        (1513, 1571),
        (1491, 1584),
        (1471, 1599),
        (1456, 1619),
        (1436, 1641),
        (1413, 1663),
        (1430, 1682),
        (1429, 1708),
        (1418, 1741),
        (1411, 1771),
        (1408, 1803),
        (1406, 1831),
        (1401, 1861),
        (469, 430),
        (496, 429),
        (521, 430),
        (546, 429),
        (574, 430),
        (600, 424),
        (626, 426),
        (654, 427),
        (682, 428),
        (709, 426),
        (739, 427),
        (766, 430),
        (800, 425),
        (830, 426),
        (862, 427),
        (888, 427),
        (915, 423),
        (943, 424),
        (973, 423),
        (1003, 421),
        (2133, 620),
        (2150, 639),
        (2164, 660),
        (2180, 680),
        (2194, 702),
        (2212, 722),
        (2229, 742),
        (2242, 764),
        (2257, 786),
        (2273, 806),
        (2284, 829),
        (2298, 851),
        (2313, 871),
        (2328, 894),
        (2340, 917),
        (2353, 939),
        (2365, 961),
        (2377, 984),
        (2387, 1011),
        (2400, 1033),
        (2408, 1058),
        (2407, 1085),
        (2409, 1113),
        (2409, 1138),
        (2411, 1168),
        (2413, 1196),
        (2417, 1227),
        (2422, 1255),
        (2425, 1287),
        (2430, 1316),
        (2435, 1347),
        (2439, 1375),
        (2442, 1403),
        (2446, 1428),
        (2451, 1455),
        (2456, 1480),
        (2464, 1505),
        (2466, 1532),
        (2470, 1557),
        (2485, 1581),
        (2485, 1607),
        (2502, 1628),
        (2513, 1655),
        (2523, 1680),
        (2536, 1710),
        (2544, 1735),
        (629, 687),
        (686, 641),
        (710, 621),
        (660, 661),
        (640, 678),
        (687, 640),
        (646, 672),
        (626, 688),
        (671, 649),
        (627, 679),
        (602, 693),
        (578, 703),
        (554, 712),
        (528, 722),
        (503, 731),
        (477, 742),
        (450, 754),
        (422, 765),
        (394, 776),
        (378, 798),
        (397, 760),
        (362, 803),
        (391, 763),
        (359, 807),
        (358, 833),
        (331, 824),
        (338, 781),
        (327, 812),
        (307, 827),
        (286, 844),
        (268, 826),
        (245, 841),
        (215, 872),
        (192, 882),
        (167, 882),
        (144, 894),
        (125, 914),
        (99, 921),
        (71, 926),
        (1843, 659),
        (1845, 684),
        (1846, 710),
        (1843, 736),
        (1840, 761),
        (1836, 787),
        (1833, 812),
        (1830, 837),
        (1824, 862),
        (1823, 887),
        (1819, 914),
        (1814, 941),
        (1811, 968),
        (1808, 995),
        (1804, 1024),
        (1800, 1049),
        (1795, 1078),
        (1790, 1104),
        (1788, 1129),
        (1780, 1155),
        (1772, 1190),
        (1761, 1220),
        (1750, 1247),
        (1740, 1271),
        (1729, 1295),
        (1720, 1320),
        (1710, 1345),
        (1699, 1372),
        (1690, 1397),
        (1680, 1424),
        (1668, 1447),
        (1662, 1472),
        (1652, 1501),
        (1643, 1534),
        (1633, 1557),
        (1618, 1581),
        (1600, 1601),
        (1582, 1620),
        (1565, 1640),
        (1549, 1664),
        (1526, 1691),
        (1499, 1711),
        (1497, 1743),
        (1485, 1769),
        (1475, 1793),
        (1464, 1823),
        (1456, 1848),
        (1437, 1872),
        (543, 757),
        (518, 766),
        (492, 777),
        (464, 785),
        (437, 794),
        (413, 803),
        (388, 814),
        (364, 822),
        (339, 836),
        (315, 850),
        (297, 872),
        (269, 872),
        (243, 886),
        (212, 898),
        (185, 906),
        (158, 918),
        (137, 932),
        (122, 957),
        (102, 976),
        (77, 980),
        (54, 991),
        (34, 1008),
        (22, 1030),
        (12, 1058),
        (1370, 702),
        (1352, 720),
        (1332, 737),
        (1311, 754),
        (1291, 772),
        (1270, 791),
        (1251, 809),
        (1231, 826),
        (1211, 842),
        (1191, 859),
        (1172, 876),
        (1152, 894),
        (1131, 914),
        (1112, 931),
        (1090, 951),
        (1070, 970),
        (1051, 988),
        (1032, 1007),
        (1013, 1024),
        (993, 1043),
        (973, 1060),
        (955, 1078),
        (935, 1093),
        (917, 1111),
        (900, 1130),
        (877, 1148),
        (858, 1166),
        (834, 1186),
        (814, 1203),
        (792, 1221),
        (767, 1242),
        (741, 1261),
        (713, 1284),
        (695, 1302),
        (677, 1320),
        (656, 1338),
        (635, 1357),
        (511, 1473),
        (468, 1512),
        (445, 1533),
        (425, 1550),
        (406, 1570),
        (382, 1590),
        (363, 1614),
        (339, 1632),
        (319, 1650),
        (298, 1670),
        (273, 1689),
        (245, 1715),
        (226, 1733),
        (203, 1754),
        (179, 1774),
        (152, 1799),
        (122, 1828),
        (101, 1845),
        (79, 1864),
        (57, 1884),
        (261, 437),
        (284, 447),
        (310, 452),
        (335, 456),
        (360, 459),
        (385, 461),
        (411, 464),
        (436, 467),
        (424, 492),
        (396, 499),
        (368, 502),
        (342, 508),
        (317, 503),
        (342, 503),
        (312, 504),
        (287, 507),
        (321, 509),
        (346, 510),
        (294, 509),
        (266, 509),
        (292, 518),
        (267, 519),
        (236, 524),
        (267, 527),
        (234, 530),
        (259, 528),
        (234, 527),
        (259, 527),
        (218, 530),
        (193, 534),
        (168, 540),
        (143, 544),
        (159, 575),
        (144, 596),
        (127, 564),
        (128, 595),
        (1443, 651),
        (1424, 668),
        (1404, 685),
        (1386, 703),
        (1368, 721),
        (1349, 739),
        (1331, 757),
        (1314, 776),
        (1296, 795),
        (1278, 813),
        (1187, 910),
        (1159, 939),
        (1138, 956),
        (1115, 974),
        (1093, 992),
        (1072, 1010),
        (1051, 1027),
        (1031, 1042),
        (1011, 1062),
        (988, 1081),
        (963, 1099),
        (942, 1119),
        (919, 1140),
        (900, 1157),
        (875, 1177),
        (855, 1196),
        (834, 1214),
        (810, 1237),
        (785, 1256),
        (758, 1280),
        (739, 1299),
        (719, 1314),
        (697, 1327),
        (674, 1350),
        (650, 1369),
        (625, 1393),
        (598, 1409),
        (573, 1431),
        (546, 1461),
        (521, 1484),
        (498, 1503),
        (476, 1522),
        (456, 1542),
        (428, 1565),
        (401, 1584),
        (382, 1601),
        (362, 1618),
        (342, 1634),
        (323, 1651),
        (303, 1669),
        (277, 1689),
        (256, 1709),
        (232, 1731),
        (205, 1755),
        (185, 1774),
        (163, 1794),
        (137, 1819),
        (102, 1855),
        (78, 1874),
        (1759, 957),
        (1759, 982),
        (1756, 1014),
        (1755, 1039),
        (1758, 1073),
        (1762, 1098),
        (1762, 1126),
        (1756, 1158),
        (1752, 1186),
        (1751, 1211),
        (1744, 1236),
        (1739, 1261),
        (1739, 1286),
        (1737, 1312),
        (1732, 1339),
        (1723, 1364),
        (1726, 1391),
        (1721, 1417),
        (1715, 1442),
        (1715, 1472),
        (1713, 1497),
        (1706, 1524),
        (1699, 1549),
        (1693, 1574),
        (1683, 1606),
        (1676, 1630),
        (1653, 1648),
        (1639, 1678),
        (1632, 1704),
        (1620, 1727),
        (1612, 1757),
        (1604, 1724),
        (1591, 1763),
        (1587, 1731),
        (1562, 1725),
        (1538, 1746),
        (1513, 1762),
        (1490, 1780),
        (1469, 1795),
        (1519, 1795),
        (1526, 1820),
        (1500, 1818),
        (1522, 1792),
        (1511, 1816),
        (1528, 1796),
        (1526, 1821),
        (1525, 1795),
        (1530, 1820),
        (1527, 1795),
        (1511, 1821),
        (1528, 1800),
        (1540, 1822),
        (1534, 1795),
        (1522, 1820),
        (1493, 1834),
        (1479, 1860),
        (1478, 1891),
        (2242, 747),
        (2240, 772),
        (2238, 798),
        (2244, 823),
        (2257, 847),
        (2270, 869),
        (2289, 890),
        (2304, 913),
        (2320, 937),
        (2333, 960),
        (2347, 982),
        (2355, 1006),
        (2366, 1031),
        (2377, 1058),
        (2387, 1088),
        (2399, 1118),
        (2407, 1147),
        (2413, 1184),
        (2415, 1212),
        (2416, 1249),
        (2417, 1275),
        (2418, 1310),
        (2422, 1338),
        (2425, 1364),
        (2428, 1395),
        (2437, 1428),
        (2440, 1456),
        (2444, 1491),
        (2448, 1525),
        (2453, 1555),
        (2460, 1584),
        (2468, 1608),
        (2484, 1628),
        (2496, 1653),
        (2504, 1677),
        (2513, 1708),
        (2522, 1738),
        (2529, 1766),
        (2536, 1797),
        (2550, 1831),
        (2560, 1858),
        (1467, 628),
        (1450, 648),
        (1431, 665),
        (1416, 685),
        (1393, 697),
        (1373, 712),
        (1356, 732),
        (1335, 749),
        (1315, 766),
        (1292, 782),
        (1271, 801),
        (1253, 820),
        (1234, 837),
        (1213, 854),
        (1195, 872),
        (1175, 892),
        (1154, 912),
        (1133, 932),
        (1110, 954),
        (1090, 975),
        (1067, 993),
        (1046, 1014),
        (1027, 1031),
        (1007, 1051),
        (987, 1069),
        (966, 1090),
        (946, 1108),
        (928, 1126),
        (906, 1144),
        (883, 1168),
        (857, 1193),
        (835, 1213),
        (809, 1235),
        (779, 1264),
        (744, 1295),
        (706, 1330),
        (684, 1350),
        (661, 1371),
        (636, 1395),
        (611, 1417),
        (584, 1442),
        (553, 1468),
        (523, 1495),
        (493, 1524),
        (461, 1549),
        (428, 1570),
        (397, 1587),
        (362, 1613),
        (334, 1639),
        (304, 1666),
        (272, 1693),
        (238, 1723),
        (201, 1755),
        (181, 1773),
        (162, 1791),
        (138, 1812),
        (110, 1836),
        (73, 1871),
        (356, 1036),
        (332, 1049),
        (309, 1063),
        (285, 1076),
        (275, 1105),
        (258, 1126),
        (244, 1157),
        (233, 1180),
        (207, 1188),
        (181, 1201),
        (156, 1207),
        (130, 1216),
        (108, 1228),
        (86, 1247),
        (69, 1269),
        (52, 1288),
        (1824, 588),
        (1822, 613),
        (1822, 638),
        (1820, 664),
        (1817, 689),
        (1811, 714),
        (1808, 740),
        (1801, 766),
        (1798, 791),
        (1791, 815),
        (1785, 840),
        (1780, 866),
        (1773, 890),
        (1769, 917),
        (1762, 941),
        (1755, 965),
        (1749, 990),
        (1742, 1015),
        (1735, 1042),
        (1728, 1066),
        (1721, 1092),
        (1714, 1116),
        (1706, 1143),
        (1697, 1167),
        (1689, 1192),
        (1681, 1219),
        (1675, 1248),
        (1665, 1276),
        (1659, 1301),
        (1652, 1330),
        (1643, 1354),
        (1635, 1380),
        (1627, 1404),
        (1618, 1429),
        (1610, 1457),
        (1599, 1484),
        (1591, 1512),
        (1581, 1541),
        (1576, 1567),
        (1568, 1592),
        (1553, 1617),
        (1534, 1636),
        (1516, 1655),
        (1501, 1676),
        (1490, 1700),
        (1472, 1723),
        (1477, 1750),
        (1469, 1774),
        (1461, 1803),
        (1456, 1832),
        (1447, 1865),
        (1441, 1894),
        (920, 589),
        (895, 596),
        (846, 616),
        (822, 625),
        (800, 638),
        (775, 647),
        (751, 656),
        (727, 666),
        (704, 676),
        (679, 686),
        (655, 696),
        (632, 710),
        (608, 720),
        (582, 729),
        (554, 739),
        (526, 750),
        (501, 762),
        (475, 769),
        (449, 776),
        (424, 787),
        (398, 796),
        (374, 808),
        (351, 825),
        (323, 835),
        (301, 847),
        (275, 856),
        (252, 868),
        (227, 877),
        (205, 890),
        (190, 913),
        (170, 928),
        (153, 947),
        (153, 921),
        (156, 946),
        (128, 946),
        (107, 961),
        (83, 970),
        (60, 981),
        (41, 1001),
        (1788, 566),
        (1788, 591),
        (1785, 616),
        (1785, 641),
        (1785, 667),
        (1781, 692),
        (1783, 717),
        (1779, 742),
        (1774, 768),
        (1766, 792),
        (1762, 818),
        (1755, 843),
        (1752, 869),
        (1747, 894),
        (1739, 918),
        (1736, 945),
        (1727, 970),
        (1721, 995),
        (1711, 1019),
        (1701, 1048),
        (1691, 1074),
        (1683, 1098),
        (1674, 1125),
        (1668, 1150),
        (1659, 1179),
        (1651, 1205),
        (1641, 1234),
        (1629, 1266),
        (1619, 1292),
        (1606, 1319),
        (1594, 1346),
        (1584, 1379),
        (1573, 1409),
        (1560, 1435),
        (1548, 1472),
        (1536, 1509),
        (1523, 1545),
        (1510, 1571),
        (1492, 1595),
        (1467, 1613),
        (1452, 1633),
        (1439, 1657),
        (1427, 1680),
        (1407, 1699),
        (1419, 1725),
        (1416, 1754),
        (1411, 1782),
        (1401, 1817),
        (1396, 1844),
        (1389, 1874),
        (1782, 629),
        (1779, 655),
        (1775, 680),
        (1772, 705),
        (1769, 730),
        (1763, 756),
        (1759, 783),
        (1754, 809),
        (1750, 834),
        (1741, 858),
        (1740, 883),
        (1733, 910),
        (1726, 936),
        (1717, 963),
        (1710, 989),
        (1702, 1018),
        (1694, 1046),
        (1686, 1072),
        (1677, 1096),
        (1671, 1123),
        (1662, 1149),
        (1656, 1174),
        (1651, 1201),
        (1644, 1225),
        (1640, 1250),
        (1630, 1276),
        (1619, 1307),
        (1612, 1333),
        (1606, 1358),
        (1599, 1385),
        (1589, 1412),
        (1579, 1444),
        (1567, 1478),
        (1560, 1503),
        (1552, 1528),
        (1539, 1554),
        (1522, 1576),
        (1503, 1593),
        (1481, 1608),
        (1472, 1633),
        (1461, 1657),
        (1445, 1677),
        (1459, 1700),
        (1451, 1726),
        (1447, 1751),
        (1439, 1777),
        (1433, 1806),
        (1425, 1835),
        (1416, 1871),
        (1386, 1894),
        (2169, 656),
        (2183, 677),
        (2198, 699),
        (2228, 751),
        (2243, 773),
        (2253, 796),
        (2267, 819),
        (2279, 843),
        (2290, 868),
        (2301, 895),
        (2313, 918),
        (2324, 942),
        (2336, 966),
        (2349, 991),
        (2364, 1012),
        (2374, 1035),
        (2384, 1058),
        (2395, 1083),
        (2396, 1108),
        (2398, 1138),
        (2402, 1165),
        (2405, 1190),
        (2408, 1218),
        (2412, 1243),
        (2415, 1270),
        (2418, 1299),
        (2425, 1326),
        (2428, 1351),
        (2431, 1377),
        (2435, 1405),
        (2442, 1429),
        (2447, 1457),
        (2447, 1488),
        (2447, 1516),
        (2451, 1548),
        (2461, 1574),
        (2475, 1600),
        (2486, 1624),
        (2495, 1649),
        (2506, 1680),
        (2518, 1714),
        (2527, 1745),
        (2541, 1776),
        (2555, 1816),
        (2563, 1845),
        (2569, 1877),
        (330, 432),
        (359, 440),
        (385, 445),
        (411, 450),
        (437, 451),
        (463, 454),
        (489, 467),
        (465, 476),
        (440, 482),
        (410, 489),
        (385, 495),
        (356, 501),
        (331, 509),
        (304, 517),
        (272, 526),
        (241, 534),
        (218, 544),
        (191, 550),
        (163, 553),
        (141, 541),
        (119, 556),
        (91, 570),
        (64, 579),
        (985, 701),
        (913, 735),
        (888, 749),
        (867, 763),
        (843, 772),
        (819, 780),
        (800, 798),
        (778, 810),
        (755, 824),
        (731, 834),
        (708, 848),
        (682, 862),
        (656, 877),
        (629, 891),
        (606, 902),
        (583, 916),
        (558, 929),
        (535, 941),
        (510, 954),
        (483, 968),
        (460, 982),
        (438, 996),
        (415, 1007),
        (393, 1020),
        (365, 1037),
        (336, 1052),
        (313, 1066),
        (288, 1079),
        (260, 1094),
        (237, 1106),
        (227, 1131),
        (214, 1157),
        (201, 1186),
        (188, 1218),
        (155, 1231),
        (130, 1246),
        (104, 1255),
        (80, 1247),
        (62, 1267),
        (49, 1294),
        (36, 1322),
        (407, 463),
        (432, 470),
        (456, 479),
        (444, 501),
        (415, 508),
        (385, 514),
        (357, 520),
        (333, 527),
        (307, 533),
        (281, 545),
        (249, 556),
        (227, 572),
        (203, 557),
        (188, 577),
        (161, 579),
        (137, 588),
        (111, 587),
        (91, 606),
        (63, 610),
    ]
)

# filter out the points with y values less than 630
X = np.array([point for point in X if point[1] > 630])

import numpy as np
from sklearn.mixture import BayesianGaussianMixture
import matplotlib.pyplot as plt


# Initialize and fit the GMM
gmm = GMM(k=4, tol=1e-7, max_iters=120, warm_start=True)
gmm.fit(X)
gmm.fit(np.array([        (10, 30),
        (30, 60),]))


# bgm = BayesianGaussianMixture(
#     n_components=5,
#     covariance_type="full",
#     max_iter=120,
#     tol=1e-7,
#     init_params="random",
# )
# bgm.fit(X)

plt.figure(figsize=(15, 15))
plt.subplot(1, 1, 1)
plt.title("Gaussian Mixture Model", fontsize=16)
plt.scatter(X[:, 0], X[:, 1], c=gmm.predict(X), cmap="viridis")
plt.scatter(gmm.means[:, 0], gmm.means[:, 1], c="red", s=100, alpha=0.5)
# plt.subplot(1, 2, 2)
# plt.title("Bayesian Mixture Model", fontsize=16)
# plt.scatter(X[:, 0], X[:, 1], c=bgm.predict(X), cmap="viridis")
# plt.scatter(bgm.means_[:, 0], bgm.means_[:, 1], c="red", s=100, alpha=0.5)


plt.legend()
plt.tight_layout()
plt.show()

# # Fit the scikit-learn Gaussian Mixture Model
# gmm_model = GaussianMixture(n_components=3, init_params="k-means++", warm_start=True)
# gmm_clusters = gmm_model.fit_predict(X)

# # Plot results side by side
# plt.figure(figsize=(20, 15))

# # First subplot for the scikit-learn GMM clustering result
# plt.subplot(1, 2, 1)
# plt.scatter(X[:, 0], X[:, 1], c=gmm_clusters, s=50, cmap="plasma")
# plt.title("Gaussian Mixture Model (scikit-learn)", fontsize=16)

# # Second subplot for the custom GMM predictions
# plt.subplot(1, 2, 2)
# plt.scatter(X[:, 0], X[:, 1], c=gmm.predict(X), s=50, cmap="viridis")
# plt.title("Gaussian Mixture Model (Custom)", fontsize=16)

# plt.legend()
# plt.tight_layout()
# plt.show()
